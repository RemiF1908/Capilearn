<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Capilearn</title>
</head>
<body onload="init()">
<h1>Capilearn</h1>
    <button id="start" onclick="start(game)">Démarrer</button>
    <div id="game">
        <p id="pays"></p>
        <p id="capitale"></p>

    </div>
<p id="check"></p>
</body>
</html>

<script>
    i=0;
    score = 0;
    function init() {
        var game = document.getElementById('game');
        game.style.display = 'none';
    }
    function start(callback){

        var game = document.getElementById('game');
        game.style.display = 'block';
        var start = document.getElementById('start');
        start.style.display = 'none';
        var getHttpRequest = function () {
            var httpRequest = false;
            if (window.XMLHttpRequest) { // Mozilla, Safari,...
                httpRequest = new XMLHttpRequest();
                if (httpRequest.overrideMimeType) {
                    httpRequest.overrideMimeType('text/json');
                }
            } else if (window.ActiveXObject)// IE
            {
                try {
                    httpRequest = new ActiveXObject("Msxml2.XMLHTTP");
                } catch (e) {
                    try {
                        httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
                    } catch (e) {
                    }
                }
            }

            if (!httpRequest) {
                alert('Abandon :( Impossible de créer une instance XMLHTTP');
                return false;
            }
            return httpRequest
        }

        var xhr = getHttpRequest()
        xhr.open('GET', 'capitales.json', true) //recup du fichier gain
        xhr.send()

        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    document.getElementById('check').innerText = "";
                    req = xhr.responseText;
                    capitales = JSON.parse(req);

                    var listeCapitales = Object.keys(capitales).map(function(cle) {
                        return [cle, capitales[cle]];
                    });

                    callback(listeCapitales);



                } else {
                    document.getElementById('check').innerText = 'Erreur 404';
                }
            }
            if (xhr.readyState !== 4) {
                document.getElementById('check').innerText = 'Chargement';
            }
        }
    }

    function game(liste){
        document.getElementById('pays').innerText = liste[0][0];
        i=1;
        document.addEventListener("keydown", event => {
            if (event.isComposing || event.keyCode === 32)
            {
                if (i===liste.length)
                {
                    fin();
                    return;
                }
                document.getElementById('capitale').innerText = '';
                document.getElementById('pays').innerText = liste[i][0];
                i += 1;
            }
            else
            {
                document.getElementById('capitale').innerText = liste[i-1][1];
                score+=1;
            }
        });
    }
    function fin(){
        document.getElementById('pays').innerText = score;
    }

</script>

<style>
    h1{
        font-family: Futura-Normal;
        font-size: 80px;
        text-align: center;
    }
    #game{
        font-family: "Roboto";
        font-size: 40px;
        text-align: center;
    }
</style>